# .github/workflows/jekyll-build.yml
name: Deploy Jekyll site to GitHub Pages

on:
  push:
    branches:
      - main # Change to 'master' if your main branch is master
    paths:
      - 'docs/**' # Trigger this workflow only when changes happen in the docs/ folder

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.3' # IMPORTANT: Ensure this matches your local Ruby version from `ruby -v` or `rbenv version`. If your local is 3.4, use '3.4'.
          bundler-cache: true # Installs gems from Gemfile.lock (and caches them)

      - name: Build Jekyll site
        # Combine the `cd docs`, `bundle install` configuration, and `jekyll build`
        # into a single `run` block. This ensures the shell environment
        # (including PATH updates from bundler) is consistent for all commands.
        run: |
          echo "Current working directory: $(pwd)"
          echo "Navigating to docs directory..."
          cd docs
          echo "New working directory: $(pwd)"

          echo "Configuring Bundler to install gems to vendor/bundle..."
          # Configure bundler to install gems to vendor/bundle within the action's environment
          bundle config set --local path vendor/bundle
          echo "Installing gems from Gemfile.lock..."
          bundle install --jobs 4 --retry 3 # Install gems (this will use your Gemfile.lock)
          echo "Gem installation complete."

          echo "Building Jekyll site..."
          # Build the site into a '_site' folder *outside* the docs directory
          # This is relative to the *original* repo root, so we go up one level.
          bundle exec jekyll build --baseurl "/Cardikit" --destination ../_site
          echo "Jekyll build complete."
        env:
          JEKYLL_ENV: production # Build in production mode

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: _site # The path to the built site, relative to the repository root

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
